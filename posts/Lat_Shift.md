# Latitudinal Shifts of Plant Functional Types within the Great Plains
---
**Author**: Paul Lin (Mentors: Brent Helliker & Jane Dmochowski - University of Pennsylvania)

**Date**: May 2021

**Project Description:** 
Grass-based biomes are one of the most important ecosystems and provide numerous crucial functions and services, yet remain as one of the world’s most vulnerable ecosystems today. In particular, the distribution of Plant Functional Types (PFT) between C3 grasses and C4 grasses are expected to shift dramatically due to grass’ sensitivity to changes in environmental factors. Within this study, a set of twelve annual phenological metrics were extracted from the Normalized Difference Vegetation Index (NDVI) profiles along five training clusters and three testing latitudinal transects between 2010 and 2020. Phenological metric value measurements from the training sites were used as features to construct machine learning models for predicting site PFT classification (C3-majority or C4-majority). The resulting predictions were used to analyze potential shifts in the spatiotemporal distribution of grass PFTs and its correlations with temperature and precipitation changes within the North American Great Plains. 

## Introduction
---
#### The Importance of Grasslands
Grasses and grass-based biomes play crucial roles in ecological functions and human development. Grass-based biomes (savannas, grasslands, and shrublands) span an area of over 4000 million ha and yield an annual total net primary productivity of 13.7 Pg C, approximately one-third of the Earth’s total land surface and total terrestrial productivity. Grass-based ecosystems serve important ecological functions as carbon storage reservoirs, nitrogen fixation sources, wildlife habitat, and water flow and quality regulators. Nonetheless, accelerated changes in climate and land use patterns have drastically reduced global grasslands cover in recent years, with natural grasslands areas having shrunk by 92%, the most significant reduction of any natural biomes. Within grasslands, changes in regional climate patterns have also induced significant shifts in the PFT distribution of C3 and C4 grasses with major global and regional implications. First, domesticated C3 and C4 grasses are critical to global agricultural productivity, with wheat (C3), rice (C3), and maize (C4) accounting for 20%, 19%, and 5% of the world’s global caloric intake respectively. Second, C3 grasses generally live longer and carry more biomass than C4 grasses, and so serve as better carbon reservoirs than C4 grasses. As such, even minor expansions or contractions of C3 and C4 grass territorial boundaries could have substantial impacts on global food security and the global carbon cycle.
#### Methods for Analyzing PFT Distribution
Past methods for analyzing PFT distribution have typically utilized field-collected measurements of carbon isotope concentration to classify sites as C3-majority or C4-majority. However, field-collected measurements are often constrained by high costs, infrequent and limited spatial coverage, and coarse temporal resolution. As such, PFT classification methods classification metrics derived from remotely-sensed measurements have become increasingly popular due to the low cost, regular and high spatial coverage, and fine temporal resolution produced by remotely-sensed measurements. One such method for site PFT classification is based on the asynchronous seasonal profiles between C3 and C4 plants in which C3 plants exhibit greater photosynthetic activity in the moist and cool spring and late fall while C4 plant exhibit greater photosynthetic activity in the dry and hot summer. Consequentially, C3-majority and C4-majority sites yield different ranges of values for temporal-based phenological metrics such as date of onset of greenness (season start), date of end of greenness (season end), date of maximum greenness, and duration of greenness (season length), all of which can be used for classification purposes. As such, this study will utilize these temporal-based metrics as features for building a site PFT classifier.

## Datasets
---
- **[National Ecological Network (NEON)](https://data.neonscience.org/data-products/DP1.10058.001)**: NEON product DP1.10058.001 (Plant Species Presence and Percent Cover) documents the existing plant species and their respective percent cover at multiple sample plots located within NEON Terrestrial Observations System (TOS) sites. NEON product DP1.10058.001 data were used in this study to prescribe PFT classification to training plots as C3-majority or C4-majority plots.
- **[Moderation Resolution Imaging Spectroradiometer (MODIS)](https://developers.google.com/earth-engine/datasets/catalog/MODIS_006_MOD09Q1)**: MODIS surface reflectance data are collected from the Terra Surface Reflectance 8-Day Global 250m (MOD09Q1.006) dataset. In this study, MODIS surface reflectance data was collected from 2010 to 2020 at each training and testing plot on an 8-day interval. For training plots spanning multiple pixels, the average reflectance value of the pixels within the training plot’s boundaries was used instead. NDVI can be calculated from MODIS surface reflectance data as (Band1 – Band2) / (Band1 + Band2), with Band1 representing the near-infrared band and Band2 representing the red band.
- **[Copernicus](https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S2_SR)**: Within this study, precipitation and temperature data were collected from 2010 to 2020 at each testing plot on a daily interval from Copernicus’ ERA5 daily aggregate dataset.
- **[National Land Cover Database (NLCD)](https://www.mrlc.gov/national-land-cover-database-nlcd-2016)**: The National Land Cover Database (NLCD) is a 30-m resolution nationwide land cover dataset based on the Landsat satellite. Amongst the land cover classes delineated by NLCD 2016, four land classes are considered herbaceous: Shrub/Scrub, Grassland/Herbaceous, Pasture/Hay, and Barren Land. These four land cover classes were extracted to generate an herbaceous land cover mask to ensure that training and testing sites only occupied herbaceous lands.
<p align = "center"><img src="https://github.com/paulslin/paulslin.github.io/blob/main/images/Lat_Shift/NLCD.PNG?raw=true"></p>
<p align = "center"><i>NLCD 2016 classification of the contiguous United States </i></p>

## Study Area
---
<p align = "center"><img src="https://github.com/paulslin/paulslin.github.io/blob/main/images/Lat_Shift/Training_Testing_Sites.PNG?raw=true"></p>
<p align = "center"><i>The Great Plains Ecoregion: Training Sites (left) and Testing Sites (right)</i></p>

#### Great Plains Ecoregion
The North American Great Plains (Great Plains) occupies an area of approximately 3.5 million km<sup>2</sup> and is the world’s second largest contiguous grasslands ecoregion. Due to extensive variations in climatic and topographic properties, the Great Plains hosts a variety of grass species from multiple PFTs, largely delineated along latitudinal temperature and longitudinal precipitation gradients. From a latitudinal perspective, temperature gradients decrease from north to south, with the cool northern regions exhibiting the highest C3:C4 ratio and the warm southern regions exhibiting the highest C4:C3 ratio. From a longitudinal perspective, precipitation gradients decrease from east to west and result in tallgrass prairies occupying the wet eastern regions, mixed-grass prairies occupying the central regions, and shortgrass prairies occupying the dry western regions.

#### Training Sites
Five NEON domains are associated with the Great Plains ecoregion: Prairie Peninsula, Northern Plains, Central Plains, Southern Plains, and Desert Southwest. For each of the five domains, a NEON TOS site was chosen to represent the associated domain. Environmental and biological observations were collected from sampling plots within these TOS sites to be used as training data. Altogether, these five TOS sites span across a wide climatic and topographic range and broadly represent the habitats of various C3 and C4 grass species within the Great Plains.
<p align = "center"><img src="https://github.com/paulslin/paulslin.github.io/blob/main/images/Lat_Shift/seasonal_profiles.PNG?raw=true"></p>
<p align = "center"><i>Seasonal NDVI profiles across training sites</i></p>

#### Testing Sites
Three latitudinal transects (East, Central, West) were drawn over the Great Plains ecoregion to serve as baselines for generating herbaceous testing sites. The East Transect occupies the Temperate Prairies ecoregion, a region characterized by high precipitation and tallgrass presence. The Central Transect and West Transect, drawn along the 100°W longitude and 104°W longitude respectively, occupy the Semiarid Prairies ecoregions, a region characterized by low precipitation and shortgrass presence. 400 preliminary sites were randomly generated along each transect and an NLCD herbaceous land cover mask was applied to filter out sites occupying non-herbaceous lands. From the pool of remaining preliminary sites, 100 herbaceous sites were randomly chosen along each transect as testing sites for a total of 300 testing sites.

## Data Preprocessing
---
#### <a id="plot_classifification_anchor">Plot PFT Classification</a>
Each DP1.10058.001 dataset was comprised of entries composed of plot id, year, NLCD class, species’ scientific name, and species percent cover. A PFT master list matching species scientific name to their corresponding PFT class was compiled from the TRY Plant Trait Database and other resources. The PFT of individual entries within the DP1.10058.001 dataset was then identified by joining the DP1.10058.001 dataset with the PFT master list based on the species’ scientific name. Finally, the sum of C3 percent cover and sum of C4 percent cover was calculated by aggregating and summing the percent cover values of entries sharing the same plot id, year, and PFT. For a given plot, if the sum of C3 percent cover was greater than the sum of C4 percent cover, the plot was classified as C3-majority. Otherwise, the plot was classified as C4-majority.
<p align = "center"><img src="https://github.com/paulslin/paulslin.github.io/blob/main/images/Lat_Shift/Relational_Schema.png?raw=true"></p>
<p align = "center"><i>Relational Schema and Flow Diagram of plot PFT Classification processes: table indexes are indicated by italics, join attributes by blue text, and grouping attributes by red text</i></p>
  
#### <a id="NDVI_ts_anchor">NDVI Time-Series</a>
The MOD09Q1.006 product data was used to construct a continuous NDVI time-series between 2010 and 2020 at each training plot. The maximum-value-composite (MVC) technique applied was found to be insufficiently comprehensive for removing the effects of cloud and aerosol contaminations on NDVI values. As such, two additional filters were applied to smooth the NDVI time-series: 1) a five-point median filter to reduce major cloud contamination effects; 2) a Savitzky-Golay filter to reduce minor atmospheric effects. The resulting time-series exhibited relative smoothness, so no additional smoothing techniques were applied. Finally, a linear interpolation technique was applied on the smoothed time-series to increase the time-series’ temporal resolution from one value per eight days to one value per day.
<p align = "center"><img src="https://github.com/paulslin/paulslin.github.io/blob/main/images/Lat_Shift/Time_Series.PNG?raw=true"></p>
<p align = "center"><i>Sample raw and smoothed NDVI time-series over 10-years (left) and 1-year (right) timeframe</i></p>
  
#### Phenological Metrics
A set of twelve phenological metrics were identified by Reed and et al. to be extractable from the NDVI time-series and significant for measuring ecosystem performances. These metrics are divided into three categories: 1) temporal: event timing values; 2) NDVI-based: event NDVI values; 3) derived: time-series derivation values.  A summary of the metric definition and extract methods are given below.
<p align = "center"><img src="https://github.com/paulslin/paulslin.github.io/blob/main/images/Lat_Shift/Phenological_Metrics_Table.png?raw=true"></p>
<p align = "center"><img src="https://github.com/paulslin/paulslin.github.io/blob/main/images/Lat_Shift/Phenological_Metrics_Graph.png?raw=true"></p>
<p align = "center"><i>Phenological metrics extracted from NDVI time series identified by Reed et al. (1994)</i></p>

## Modelling
---
#### Model Inputs
Training data was created by joining the plot PFT classification data and the plot phenological features data based on the plot id and year keys (see <a href="#plot_classifification_anchor">Plot PFT Classification</a>). The resulting entries were comprised of three components:
- an identifier (plot id and year)
- a PFT label (isC3 or isC4)
- a set of features (the 12 phenological metrics)

#### Model Selection
A series of steps and comparisons were undertaken to determine the model's optimal base classifier. First, training data was split into 67% input data and 33% validation data.  Since the input dataset contained more C3-majority plots than C4-majority plots, three sets of sampling techniques were performed over the input data: 1) no sampling techniques; 2) oversampling; 3) under-sampling. Oversampling and undersampling techniques were applied to the input data to generate oversampling input data and undersampling input data. Six model types were considered as potential base classifiers for the learned model: 1) Logistic Regression (LR); 2) Support Vector Machines (SVM); 3) K-Nearest Neighbors (k-NN); 4) Random Forest (RF); 5) Adaboost (ADA); 6): Gradient Boost (GBM). Each of the six base classifiers were then built three times (once from input data, oversampling input data, and undersampling input data each) then evaluated with the validation data.

Across all sampling techniques, the RF, ADA, GBM models demonstrated the highest classification accuracy.  Models built on the input data – particularly Logistic Regression and Support Vector Machine – yielded high classification accuracy by maintaining a high preference towards the C3 class. Such a result was unsurprising, given the imbalance class distribution within the input data.  Since the input data was comprised of 67% C3-majority sites and 33% C4-majority sites, models built on the input data could simply always predict C3-majoirty and still be correct 67% of the time. As a result, these models generated high numbers of false positive among the C4-majority inputs and frequently classified C4-majority sites as C3-majority due to their preference for the C3-majority class. The oversampling technique was utilized to alleviate class imbalance and reduce the models’ preferences for the majority (C3) class. In each model instance, the number of false positives among the C4 inputs were lower in models built on the oversampling input data than models built on the input data. For example, the number false positives among the C4 inputs decreased from 37, 35, 36 to 30, 30, 29 amongst the RF, ADA, and GBM models, from 50 to 31 for the LR model, and from 54 to 30 for the SVM model. Moreover, the reduction of C4 false positives was achieved while maintaining classification accuracy comparable to models built on input data.  Within this study, since both classes are equally important, the F1 and PR-AUC Curve can be used to determine the best performing classifier.

<p align = "center"><img src="https://github.com/paulslin/paulslin.github.io/blob/main/images/Lat_Shift/Confusion_Matrix.PNG?raw=true"></p>
<p align = "center"><img src="https://github.com/paulslin/paulslin.github.io/blob/main/images/Lat_Shift/Metrics.PNG?raw=true"></p>
<p align = "center"><i>Confusion matrix and metrics of no sampling (left), oversampling (center), and undersampling (right) techniques</i></p>

#### Model Tuning
Since models built on the oversampling input data and the RF, ADA, and GBM base classifiers performed the best, the base classifiers were chosen to be RF, ADA, and GBM while the sampling technique was chosen to be the oversampling technique. Hyperparameter tuning was performed on each of the base classifiers based on a 5-fold cross-validation. Each of the tuned model demonstrated an improvement in classification accuracy compared to their non-tuned counterparts. Finally, the learned model was built as an ensemble, majority-voting classifier comprised of the tuned RF base classifier, tuned ADA base classifier, and tuned GBM classifier. That is, for each set of features inputted into the learned model, three base classifiers each independently generated a PFT prediction and the final prediction of the learned model was then outputted as the majority value of the three predictions.

#### Model Predictions
A continuous, smoothed NDVI time series between 2011 and 2020 was generated for each testing site following the steps outlined in <a href="#NDVI_ts_anchor">NDVI Time-Series</a>. Afterwards, annual values for the set of phenological metrics were extracted from the smoothed NDVI time-series at each testing site and inputted into the ensemble learned model to obtain a PFT prediction for a given site and year.
<p align = "center"><img src="https://github.com/paulslin/paulslin.github.io/blob/main/images/Lat_Shift/ETL_Pipeline.PNG?raw=true"></p>
<p align = "center"><i>Pipeline procedure for obtaining site PFT prediction with input (raw NDVI time-serise) and output (PFT prediction)</i></p>

## Results
---
Testing sites were partitioned into three non-overlapping subsets: central subset (testing sites in Central Transect), east subset (testing sites in East Transect), west subset (testing sites in West Transect). Additionally, the all subset was created to include testing sites from all three transects. Each subset was then subdivided into two sub-subsets: 1) all subset testing sites classified as C3-majority by the learned model; 2) all subset testing sites classified as C4-majority by the learned model. In summary, testing sites were divided into four subsets (central, east, west, all) and eight sub-subsets (a C3 and C4 sub-subset for each of the four subsets).

Three PFT distribution attributes (count, mean latitude, and median latitude) were calculated for each sub-subset. The count attribute was calculated by counting the number of testing sites within the sub-subset. The mean and median latitude attribute were calculated by taking the mean and median values of the latitude values of testing sites within the sub-subset, essentially the centroid latitude of the sub-subsets. Pearson's Correlation tests were then calculated between each sub-subset’s PFT distribution attribute and time, yearly transect temperature, and yearly transect precipitation for a total of nine regressions tests per sub-subset.

#### PFT Distribution
<p align = "center"><img src="https://github.com/paulslin/paulslin.github.io/blob/main/images/Lat_Shift/yearly_trans.gif?raw=true"></p>
<p align = "center"><i>PFT spatiotemporal distribution (blue: C3, red: C4) at the Great Plains between 2010 and 2020.</i></p>

#### PFT Distribution vs Year
- **East Transect**: Regression correlations between time and the count of the East Transect C3 sub-subset yielded a p-value of 0.001, R2 value of -0.847, and slope of -3.809, suggesting the number of sites classified as C4-majority along the East Transect increased at the expense of the number of sites classified as C3-majority at a rate of 3.809 sites per year. Mean latitude yielded a p-value of 0.002, R2 of 0.827, and slope of 0.237, indicating that the centroid of testing sites classified as C3 shifted northward at a rate of 0.237 to 0.541 degrees latitude per year. Altogether, the simultaneous patterns at the East Transect of 1) a decrease in count of sites classified as C3-majority and 2) an increase in the centroid latitudinal value of sites classified as C3-majority suggest a northward shift of the southern boundary of the C3 territory at the East Transect. Such conclusions are supported by the figure above, which show the sites at the southern East Transect, which were mostly classified as C3-majority (blue) in 2010, gradually and consistently shifting to the C4-majority classification over the years.
- **Central and West Transect**: At the Central Transect, regression correlations were all statistically insignificant and mostly yielded p-values greater than 0.50.  In particular, there appeared to be no discernable trends in the changes in PFT distribution.
- **West Transect**: Similar to the Central Transect, regression correlations at the Western Transect were all statistically insignificant.  Here, changes in PFT distribution appeared relatively stable.
<p align = "center"><img src="https://github.com/paulslin/paulslin.github.io/blob/main/images/Lat_Shift/PFT_Distribution_Tables.PNG?raw=true"></p>
<p align = "center"><img src="https://github.com/paulslin/paulslin.github.io/blob/main/images/Lat_Shift/PFT_Distribution_Chart.PNG?raw=true"></p>
<p align = "center"><i>Regression correlation and scatter plot (blue: C3, red: C4) of Year vs PFT attributes</i></p>

#### PFT Distribution vs Environmental Factors
Temperature and precipitation generally did not correlate with the PFT distribution attributes. Across all transects and the aggregate of all transects, correlation regression between PFT attributes and temperature and precipitation variability mostly yielded p-values greater than 0.05. The one exception occurred at the West Transect between Median Latitude of C4 and Precipitation, which yielded a p-value of 0.021, a R2 value of -0.681, and a slope of -0.00684. A slope of -0.00684 indicates that for every additional 1mm of precipitation in the West Transect, the centroid of the C4 testing sites shifts south by 0.00684 degrees latitude.

## Analysis
---
Machine learning models built from data at the training sites was used to classify the testing sites as C3-dominant or C4-dominant along three latitudinal transects. An analysis on the PFT spatial distribution along the transects revealed that the classifier performed poorly along the Central Transect. In particular, the model frequently mistakenly classified low-latitude testing sites along the of the Central Transect (such as those within the Tamaulipas-Texas Semiarid Plains region) as C3-majority. These regions are characterized by hot, dry climates and desert-like environments, conditions that are known to be more inducive towards C4 growth rather than C3 growth, but the learned model classified testing sites within the region as C3-majority in all years between 2010 and 2020. Moreover, in both 2011 and 2017, the mean and median latitudes of testing sites classified as C4-majority were found to be higher than the mean and median latitudes of testing sites classified as C3-majority at the Central Transect. This result indicated that C4 grasses were more commonly found in the high-latitude regions and C3 grasses were more commonly found in the low-latitude regions, a direct contradiction to the previous observations that found high-latitude regions to be dominated by C3 grasses and low-latitude regions to be dominated by C4 grasses. In comparison, along the West and East Transects, the model performed consistently with past observations and generally classified southern sites as C4-majority and northern sites as C3-majority.

The study also found shifts in PFT distribution to be statistically insignificant at the Central and West Transect. Such observations were consistent with those of Griffith et al. (2017) who found PFT distribution at the Great Plains to have remained stable over the past 300 years. However, a northward shift in the territorial boundary of C3 grasses within the East Transect was also found to be statistically significant. Several reasons could explain why the shifts only occurred in the East Transect. First, amongst the three transects, the East Transect is the most susceptible to human interference with the native C4 tallgrass of Oklahoma, Kansas, and Nebraska often annually replaced with C3 tallgrass for pastural purposes. An analysis of the prediction map revealed that such regions were also the regions that most frequently changed PFT classes throughout the years. As such, additional inquiries may be necessary to determine if changes in PFT distribution within the East Transect were the results of natural or human factors. Second, within the Great Plains, precipitation is distributed along a longitudinal gradient, with the East Transect receiving more than 1.5 and 2 times more precipitation than the Central Transect and West Transect. Precipitation has been observed to be an important factor for influencing PFT distribution. As such, additional inquiries may also be necessary to determine if regions with higher precipitation, such as the East Transect, are more prone to PFT distribution shifts than regions with lower precipitation, such as the Central Transect and West Transect.

## Future Work
---
A primary limitation of this study was the classification accuracy of the classifier. Since regression analysis were based on predictions obtained from the learned model, considerations for the learned model’s classification accuracy were of particular importance. While the learned model appeared to have been a relatively successful classifier, several additional methods can be implemented to improve the learned model’s classification accuracy.
- **Training Data, Spatial:** As previously mentioned, the model frequently mistakenly classified low-latitude testing sites along the of the Central Transect. An overlay of the training sites over the testing transects showed that only the Central Transect lacked training sites bordering both its northern and southern regions. For example, the West Transect is bordered by the CPER site in the north-central region and JORN site in the south region and the East Transect is bordered by the WOOD site in the north region and the KONZ site in the south-central region.  Without a training site at the southern region of the Central Transect, the model may be unable to take into account the data feature irregularities and patterns that are localized to the southern Central Transect. Beyond limitations in the training data's geographical diversity, this study was also limited by the training data's class diversity. With the training data comprised of 67% C3 samples and 33% of C4 samples, models built on the imbalanced training data demonstrated a clear preference for predicting the majority class: C3. As such, a series of additional sites are recommended to be included as training sites.
<p align = "center"><img src="https://github.com/paulslin/paulslin.github.io/blob/main/images/Lat_Shift/new_sites.png?raw=true"></p>
<p align = "center"><i>Potential locations of new training sites</i></p>
- **Training Data, Temporal:** Although species migration often occurs on incredibly slow scale (decades, centuries, millennia, etc.), this study only collected training data from 2013 - 2020 since NEON only started collecting DP1.10058.001 data in 2013. To improve the training data's temporal scale, this study could also gather data from other sources with more historical data.
- **Feature Selection:** This study utilized the set of twelve NDVI time-series extracted phenological metrics identified by Reed et al. (1994) to build the learned model. However, since many of these phenological metrics were derived from one another, this set of features suffered from a high degree of multicollinearity. A correlation matrix between the feature values of the training data demonstrated high correlations between multiple features. An analysis between the number of features versus the cumulative explained variance ratio revealed that just four features accounted for over 99% of the explained variance in feature values between training data points. The inclusion of additional features, particularly those not derived from or correlated with existing features, could provide new information from which the learned model can base its classification decisions.
<p align = "center"><img src="https://github.com/paulslin/paulslin.github.io/blob/main/images/Lat_Shift/Feature_Variance.PNG?raw=true"></p>
<p align = "center"><i>Correlation Matrix (left) and Cumulative Explained Variance Ratio (right) of the 12 phenological metrics.</i></p>
- **Model Regressor:** The study can utilize a model regressor instead of a model classifier. Model regressors (i.e.: site is x% C3) provide more fine-grained details on PFT distribution and can better track changes in the intensity of C3 and C4 distribution at specific sites and along latitudinal transects.

## Conclusion
---
An analysis on the changes in PFT distribution of the North American Great Plains over the past decade was performed to identify potential shifts in PFT distributions and its correlations with environmental factors. The results found that changes in PFT distribution in the East Transect exhibited a northward migration, while the PFT distribution in the Central Transect and West Transect appeared to remain stable. Regression analysis between changes in PFT distribution and changes in environmental variables also indicated no significant dependencies between the two. Further works seeks to improve the accuracy of the learned model classifier as well as expand the scope of the analysis into considering longer temporal ranges, additional phenological features, and correlations with new environmental variables.  




